<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ace="http://www.icefaces.org/icefaces/components">
<h:head>
    <title>Тест БД</title>
    <h:outputScript library="js" name="coords.js" target="body" />

    <style>
        .coords-form {
            text-align: left;
        }

        .coord-box {
            border: 1px solid #888;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 12px;
            width: 350px;
            background: #f7f7f7;
        }

        .coord-label {
            font-weight: bold;
            margin-bottom: 6px;
            display: block;
        }
    </style>
</h:head>
<h:body>
    <header>
        <h1>Поляков Алексей Леонидович</h1>
        <h2>P3209</h2>
        <h3>Вариант 9812</h3>
    </header>
    <canvas id="graph" width="400" height="400"></canvas>
    <br />
    <h:form id="coordsForm">
        <h3>Ввод координат</h3>
        <div class="coord-box">
            <span class="coord-label">X:</span>
            <h:selectOneMenu value="#{coordBean.x}">
                <f:selectItems value="#{coordBean.possibleX}" />
            </h:selectOneMenu>
        </div>

        <div class="coord-box">
            <span class="coord-label">Y:</span>
            <h:inputText id="valueY" value="#{coordBean.y}" />
            <div id="msg" style="color:red;"></div>
        </div>

        <div class="coord-box">
            <span class="coord-label">R:</span>
            <ace:sliderEntry value="#{coordBean.slideR}" min="0" max="12" step="1" showTooltip="true">
                <ace:ajax execute="@this" render="rValue" onComplete="drawGraph();" />
            </ace:sliderEntry>

            <h:outputText id="rValue" value="#{coordBean.r}" />
        </div>

        <h:commandButton id="userBtn" value="Проверить и сохранить" action="#{coordBean.process}">
            <f:ajax execute="@form" render="pointsJson resultsPanel" onevent="onPointsUpdated" />
        </h:commandButton>

        <h:outputText id="pointsJson" value="#{dataBaseBean.pointsJson}" style="display:none" escape="false" />
        <h:messages />

        <h:panelGroup id="resultsPanel" rendered="#{not empty dataBaseBean.results}">

            <h3>Сохранённые результаты</h3>

            <h:dataTable value="#{dataBaseBean.results}" var="res" border="1" rowClasses="result-row">
                <h:column>
                    <f:facet name="header">X</f:facet>
                    #{res.x}
                </h:column>
                <h:column>
                    <f:facet name="header">Y</f:facet>
                    #{res.y}
                </h:column>
                <h:column>
                    <f:facet name="header">R</f:facet>
                    #{res.r}
                </h:column>
                <h:column>
                    <f:facet name="header">Hit</f:facet>
                    #{res.hit ? 'да' : 'нет'}
                </h:column>
                <h:column>
                    <f:facet name="header">Время</f:facet>
                    #{res.createdAt}
                </h:column>
            </h:dataTable>
        </h:panelGroup>
    </h:form>


    <h:form id="FormForJS" style="display:none">
        <h:inputText id="FieldX" value="#{coordBean.x}" />
        <h:inputText id="FieldY" value="#{coordBean.y}" />
        <h:inputText id="FieldR" value="#{coordBean.r}" />
        <h:commandButton id="submitBtn" action="#{coordBean.process}">
            <f:ajax execute="@form" render=":coordsForm:pointsJson :coordsForm:resultsPanel"
                onevent="onPointsUpdated" />
        </h:commandButton>
    </h:form>

    <h:form>
        <h:commandButton value="Перейти на начальную страницу" action="goToStart" />
    </h:form>

    <h:outputScript>
        function onPointsUpdated(data) {
        if (data.status === 'success') {
        Loadpoints();
        drawGraph();
        }
        }
    </h:outputScript>


</h:body>

</html>